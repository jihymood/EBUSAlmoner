package com.xpro.ebusalmoner.activity;

import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.util.Log;

import com.xpro.ebusalmoner.R;
import com.xpro.ebusalmoner.baseapi.BaseActivity;
import com.xpro.ebusalmoner.baseapi.BaseHandler;
import com.xpro.ebusalmoner.constants.Constants;
import com.xpro.ebusalmoner.entity.LoginDriverEntity;
import com.xpro.ebusalmoner.logic.MainLogic;
import com.xpro.ebusalmoner.utils.DateUtil;
import com.xpro.ebusalmoner.utils.MobilePhoneUtils;
import com.xpro.ebusalmoner.utils.NetUtil;
import com.xpro.ebusalmoner.utils.PreferencesUtils;
import com.xpro.ebusalmoner.utils.ToastUtils;

import butterknife.ButterKnife;


/**
 * @ClassName: WelcomeActivity
 * @Description: 欢迎界面
 * @author: houyang
 * @date: 2016年9月26日 下午3:50:23
 */
public class WelcomeActivity extends BaseActivity {
    private MainLogic mainLogic;
    private Handler handler;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_welcome);
        ButterKnife.bind(this);

        handler = new Myhandler(this);
        mainLogic = new MainLogic(handler, this);


        //判断网路是否开启
        if (!NetUtil.isNetworkOnline()) {//网络不可用
            showTip("网络不可用，请开启网络后再试", new OnCustomDialogConfirmListener() {
                @Override
                public void onClick() {
                    finish();
                }
            });
        } else {
            //网络可用
            Log.e("timeString", "time:" + DateUtil.getYMDate());
            //验证登陆接口
            mainLogic.login(MobilePhoneUtils.getMiei(this), MobilePhoneUtils.getSerialNumber());
        }


    }


    class Myhandler extends BaseHandler {
        public Myhandler(Context context) {
            super(context);
        }

        @Override
        public void handleMessage(Message msg) {
            super.handleMessage(msg);
            switch (msg.what) {
                //登录成功
                case Constants.HANDLER_LOGIN_SUCCESS:
                    ToastUtils.showToast(WelcomeActivity.this, "手机登陆验证成功");
                    LoginDriverEntity loginDeviceEntity = (LoginDriverEntity) msg.obj;
                    //将LoginID保存为文件
                    PreferencesUtils.putString(WelcomeActivity.this, "LoginId", "" + loginDeviceEntity.getPersonId());
                    Log.e("personId", "loginDeviceEntity.getPersonId():" + loginDeviceEntity.getPersonId());
                    //获取任务详情接口
//                    mainLogic.getTaskInfo(PreferencesUtils.getString(WelcomeActivity.this, "LoginId"), "2017/01/10");

                    //登陆跳转
                    startActivity(new Intent(WelcomeActivity.this, ManagerMainActivity.class));
                    finish();

                    break;

                //登录失败
                case Constants.HANDLER_LOGIN_FAIL:
                    ToastUtils.showToast(WelcomeActivity.this, "" + msg.obj);
                    break;

            }
        }
    }
}